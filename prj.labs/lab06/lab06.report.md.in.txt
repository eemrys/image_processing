## Работа 6. Выделение границ проективно искаженных прямоугольников страниц
автор: Яковлева А.А.
url: https://mysvn.ru/yakovleva/yakovleva_a_a/prj.labs/lab06

### Задание
1. Реализовать выделение "границ и уголков" на фотографиях документа.
2. Реализовать детектирование наиболее правдоподобного четырехугольника изображения страницы документа на фото.
3. Используя эталонную геометрическую разметку из лабораторной 5 реализовать численную оценку качества выделения отдельных примитивов и финального результата для отдельных изображений и для набора.
4. Реализовать представление результатов выполнения лабораторной (иллюстрации, таблицы, графики и т.д.) и вставить в отчет.

### Результаты

Для обработки изображений перед детекцией границ была применена следующая комбинация методов:
- Гауссианское сглаживание с размером окна $15*15$
- Медианное сглаживание с размером ядра $51$
- Адаптивная бинаризация (кросс-корреляция с гауссовым окном)
- Гауссианское сглаживание с размером окна $7*7$
- Гауссианское сглаживание с размером окна $15*15$


![](lab06.processed1.png)
Рис. 1. Фотография 1 после обработки

![](lab06.processed2.png)
Рис. 2. Фотография 2 после обработки

![](lab06.processed3.png)
Рис. 3. Фотография 3 после обработки

![](lab06.processed4.png)
Рис. 4. Фотография 4 после обработки

![](lab06.processed5.png)
Рис. 5. Фотография 5 после обработки

После этого к изображениям применён детектор границ Кэнни (cv::Canny).
Параметры :
- нижний порог - 100
- верхний порог - 200
- размер ядра - 5

![](lab06.canny_edges1.png)
Рис. 6. Границы, обраруженные детектором Кэнни на фотографии 1

![](lab06.canny_edges2.png)
Рис. 7. Границы, обраруженные детектором Кэнни на фотографии 2

![](lab06.canny_edges3.png)
Рис. 8. Границы, обраруженные детектором Кэнни на фотографии 3

![](lab06.canny_edges4.png)
Рис. 9. Границы, обраруженные детектором Кэнни на фотографии 4

![](lab06.canny_edges5.png)
Рис. 10. Границы, обраруженные детектором Кэнни на фотографии 5

Затем применено вероятностное преобразование Хафа(cv::HoughLinesP).
Параметры:
- \rho (длина радиус-вектора ближайшей к началу координат точки на прямой) - 2
- \theta (угол между радиус-вектором и осью абсцисс) - \pi / 180
- доверительный порог - 200
- минимальная длина отрезка - 200
- максимальный промежуток между отрезками, позволяющий соединить их - 300

Выявленные линии, наложенные на оригинальное изображение (изображены красным):

![](lab06.hough1.png)
Рис. 11. Линии, найденные преобразованием Хаффа, наложенные на изображение 1

![](lab06.hough2.png)
Рис. 12. Линии, найденные преобразованием Хаффа, наложенные на изображение 2

![](lab06.hough3.png)
Рис. 13. Линии, найденные преобразованием Хаффа, наложенные на изображение 3

![](lab06.hough4.png)
Рис. 14. Линии, найденные преобразованием Хаффа, наложенные на изображение 4

![](lab06.hough5.png)
Рис. 15. Линии, найденные преобразованием Хаффа, наложенные на изображение 5

Затем осуществлён выбор наиболее подходящих точек для углов листа. 
Для этого все линии перебирались, и из точек их начала и конца выбирались наиболее близкие к соответствующему углу фотографии точки. Таким образом были приняты предполагаемые точки границ листа

Выявленные границы листа (изображены красным) и эталонные границы (изображены синим):

![](lab06.result1.png)
Рис. 16. Найденные и эталонные границы на изображении 1

![](lab06.result2.png)
Рис. 17. Найденные и эталонные границы на изображении 2

![](lab06.result3.png)
Рис. 18. Найденные и эталонные границы на изображении 3

![](lab06.result4.png)
Рис. 19. Найденные и эталонные границы на изображении 4

![](lab06.result5.png)
Рис. 20. Найденные и эталонные границы на изображении 5

Оценка численных характеристик выявленных примитивов:
- для каждого из 4 углов подсчитывалось евклидово расстояние между найденной и эталонной точками;
- найденное расстояние разделялось на длину диагонали листа, посчитанной на основании эталонных точек;
- полученное число отнималось от единицы;
- среднее арифметическое найденных значений для каждого из углов принималось за оценку качества выделения углов для фотографии.

Оценка численных характеристик финального результата:
- по границам (линиям между углами) четырёхугольники отрисовывались на пустых картинках;
- для каждого пикселя картинок подсчитывалось, закрашен ли он на одной из картинок либо на обеих;
- результат деления второго значения на первое принято за оценку качества финального результата выявления границ листа.

Полученные численные характеристики:

|Изображение|Оценка выявления примитивов|Оценка финального результата|
|-----------------------|--------------|--------------|
|lab05.photo1.jpg|0.983|0.955| 
|lab05.photo2.jpg|0.987|0.951| 
|lab05.photo3.jpg|0.259|0.835| 
|lab05.photo4.jpg|0.306|0.904|
|lab05.photo5.jpg|0.290|0.879| 
|Набор изображений|0.565|0.905| 


### Текст программы

```cpp
@cpp_source@
```
