## Работа 7. Сегментация областей проективно искаженных прямоугольников страниц
автор: Яковлева А.А.
url: [https://mysvn.ru/yakovleva/yakovleva_a_a/prj.labs/lab07](https://mysvn.ru/yakovleva/yakovleva_a_a/prj.labs/lab07)

### Задание
1. Реализовать выделение области (сегментацию) страницы документа на фотографиях документа.
2. Используя эталонную геометрическую разметку из лабораторной 5 численно оценить качество сегментации для отдельных изображений и для набора.
3. Реализовать представление результатов выполнения лабораторной (иллюстрации, таблицы, графики и т.д.) и вставить в отчет.

### Реализация сегментации

Для обработки изображений перед сегментацией была применена следующая комбинация методов:
- Гамма-коррекция со значением $2.7$
- Медианное сглаживание с размером ядра $45$
- Лапласовская фильтрация для повышения резкости изображения (```cv::filter2D```)

Затем были выполнены следующие действия:
- используем функцию ```cv::threshold``` чтобы создать бинарное изображение из исходного.
- используем функцию ```cv::distanceTransform``` чтобы получить такое представление бинарного изображения, где значение каждого пикселя заменяется его расстоянием до ближайшего фонового пикселя.
- к полученному изображению примиряем методы ```cv::normalize``` и ```cv::threshold```, а затем выполняем операцию морфологии (```cv::dilate```), чтобы извлечь "пики" из изображения.
- используем функцию ```cv::findContours``` чтобы создать маркеры для алгоритма watershed.
- используем функцию ```cv::watershed``` чтобы изолировать объекты на изображении от фона.

### Результаты

![](lab07.segments1.png)
Рис. 1. Сегментация страницы на фотографии 1

![](lab07.segments2.png)
Рис. 2. Сегментация страницы на фотографии 2

![](lab07.segments3.png)
Рис. 3. Сегментация страницы на фотографии 3

![](lab07.segments4.png)
Рис. 4. Сегментация страницы на фотографии 4

![](lab07.segments5.png)
Рис. 5. Сегментация страницы на фотографии 5

Далее повторяются действия из лабораторной работы №6.

К сегментациям применён детектор границ Кэнни (```cv::Canny```).

![](lab07.canny_edges1.png)
Рис. 6. Границы, обнаруженные на сегментации 1

![](lab07.canny_edges2.png)
Рис. 7. Границы, обнаруженные на сегментации 2

![](lab07.canny_edges3.png)
Рис. 8. Границы, обнаруженные на сегментации 3

![](lab07.canny_edges4.png)
Рис. 9. Границы, обнаруженные на сегментации 4

![](lab07.canny_edges5.png)
Рис. 10. Границы, обнаруженные на сегментации 5

Затем применено вероятностное преобразование Хаффа(```cv::HoughLinesP```).

Выявленные линии, наложенные на оригинальное изображение (изображены красным):

![](lab07.hough1.png)
Рис. 11. Линии, найденные преобразованием Хаффа, наложенные на изображение 1

![](lab07.hough2.png)
Рис. 12. Линии, найденные преобразованием Хаффа, наложенные на изображение 2

![](lab07.hough3.png)
Рис. 13. Линии, найденные преобразованием Хаффа, наложенные на изображение 3

![](lab07.hough4.png)
Рис. 14. Линии, найденные преобразованием Хаффа, наложенные на изображение 4

![](lab07.hough5.png)
Рис. 15. Линии, найденные преобразованием Хаффа, наложенные на изображение 5

Затем осуществлён выбор наиболее подходящих точек для углов листа. 
Для этого все линии перебирались, и из точек их начала и конца выбирались наиболее близкие к соответствующему углу фотографии точки. Таким образом были приняты предполагаемые точки границ листа

Выявленные границы листа (изображены красным) и эталонные границы (изображены синим):

![](lab07.result1.png)
Рис. 16. Найденные и эталонные границы на изображении 1

![](lab07.result2.png)
Рис. 17. Найденные и эталонные границы на изображении 2

![](lab07.result3.png)
Рис. 18. Найденные и эталонные границы на изображении 3

![](lab07.result4.png)
Рис. 19. Найденные и эталонные границы на изображении 4

![](lab07.result5.png)
Рис. 20. Найденные и эталонные границы на изображении 5

Оценка численных характеристик выявленных примитивов:
- для каждого из 4 углов подсчитывалось евклидово расстояние между найденной и эталонной точками;
- найденное расстояние разделялось на длину диагонали листа, посчитанной на основании эталонных точек;
- полученное число отнималось от единицы;
- среднее арифметическое найденных значений для каждого из углов принималось за оценку качества выделения углов для фотографии.

Оценка численных характеристик финального результата:
- по границам (линиям между углами) четырёхугольники отрисовывались на пустых картинках;
- для каждого пикселя картинок подсчитывалось, закрашен ли он на одной из картинок либо на обеих;
- результат деления второго значения на первое принято за оценку качества финального результата выявления границ листа.

Полученные численные характеристики:

|Изображение|Оценка выявления примитивов|Оценка финального результата|
|-----------------------|--------------|--------------|
|lab05.photo1.jpg|0.987|0.970| 
|lab05.photo2.jpg|0.988|0.955| 
|lab05.photo3.jpg|0.305|0.961| 
|lab05.photo4.jpg|0.329|0.918|
|lab05.photo5.jpg|0.279|0.894| 
|Набор изображений|0.578|0.940| 


Можно заметить, что результаты оказались чуть лучше, чем в лабораторной работе №6.


### Текст программы

```cpp
@cpp_source@
```
